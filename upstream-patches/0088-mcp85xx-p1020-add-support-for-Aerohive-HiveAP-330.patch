From 68c2b7bb32a85ab70cb03b42c51ecd696691d749 Mon Sep 17 00:00:00 2001
From: Simon Terzenbach <simon@terzenba.ch>
Date: Mon, 12 Aug 2019 15:25:31 +0200
Subject: [PATCH] mcp85xx-p1020: add support for Aerohive HiveAP 330

---
 package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac | 2 ++
 targets/mpc85xx-p1020                                       | 4 ++++
 targets/targets.mk                                          | 1 +
 3 files changed, 7 insertions(+)
 create mode 100644 targets/mpc85xx-p1020

diff --git a/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac b/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
index 7a70e14a..c87f62f7 100755
--- a/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
+++ b/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
@@ -52,6 +52,8 @@ elseif platform.match('ar71xx', 'nand', {'hiveap-121'}) then
 elseif platform.match('ipq40xx', nil, {'avm,fritzbox-4040',
                                        'openmesh,a42', 'openmesh,a62'}) then
   table.insert(try_files, 1, '/sys/class/net/eth0/address')
+elseif platform.match('mpc85xx', 'p1020', {'aerohive,hiveap-330'}) then
+  table.insert(try_files, 1, '/sys/class/net/eth0/address')
 elseif platform.match('ramips', 'mt7621', {'dir-860l-b1'}) then
   table.insert(try_files, 1, '/sys/class/ieee80211/phy1/macaddress')
 end
diff --git a/targets/mpc85xx-p1020 b/targets/mpc85xx-p1020
new file mode 100644
index 00000000..0f038526
--- /dev/null
+++ b/targets/mpc85xx-p1020
@@ -0,0 +1,4 @@
+# Aerohive
+
+device aerohive-hiveap-330 hiveap-330
+factory
diff --git a/targets/targets.mk b/targets/targets.mk
index 9826f472..213cf8e4 100644
--- a/targets/targets.mk
+++ b/targets/targets.mk
@@ -6,6 +6,7 @@ $(eval $(call GluonTarget,ar71xx,nand))
 $(eval $(call GluonTarget,brcm2708,bcm2708))
 $(eval $(call GluonTarget,brcm2708,bcm2709))
 $(eval $(call GluonTarget,mpc85xx,generic))
+$(eval $(call GluonTarget,mpc85xx,p1020))
 $(eval $(call GluonTarget,ramips,mt7621))
 $(eval $(call GluonTarget,sunxi,cortexa7))
 $(eval $(call GluonTarget,x86,generic))
-- 
2.17.1

