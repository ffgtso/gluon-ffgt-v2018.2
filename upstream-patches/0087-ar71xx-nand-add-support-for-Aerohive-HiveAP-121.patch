From d8479d1b38fe4b44579001bf4ba9f2573499343a Mon Sep 17 00:00:00 2001
From: Simon Terzenbach <simon@terzenba.ch>
Date: Tue, 30 Jul 2019 21:00:08 +0200
Subject: [PATCH] ar71xx-nand: add support for Aerohive HiveAP 121

---
 package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac | 2 ++
 targets/ar71xx-nand                                         | 5 +++++
 2 files changed, 7 insertions(+)

diff --git a/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac b/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
index 01043b15..7a70e14a 100755
--- a/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
+++ b/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
@@ -47,6 +47,8 @@ elseif platform.match('ar71xx', 'generic', {'archer-c5', 'archer-c58-v1',
                                             'archer-c59-v1', 'archer-c60-v1',
                                             'archer-c7'}) then
   table.insert(try_files, 1, '/sys/class/net/eth1/address')
+elseif platform.match('ar71xx', 'nand', {'hiveap-121'}) then
+  table.insert(try_files, 1, '/sys/class/net/eth0/address')
 elseif platform.match('ipq40xx', nil, {'avm,fritzbox-4040',
                                        'openmesh,a42', 'openmesh,a62'}) then
   table.insert(try_files, 1, '/sys/class/net/eth0/address')
diff --git a/targets/ar71xx-nand b/targets/ar71xx-nand
index 223a6ccc..48f81025 100644
--- a/targets/ar71xx-nand
+++ b/targets/ar71xx-nand
@@ -3,6 +3,11 @@ config 'CONFIG_GLUON_SPECIALIZE_KERNEL=y'
 factory -ubi-factory .img
 sysupgrade -squashfs-sysupgrade .tar
 
+# Aerohive
+
+device aerohive-hiveap-121 hiveap-121
+factory -squashfs-factory .bin
+
 # Netgear
 
 device netgear-wndr3700v4 wndr3700v4 WNDR3700V4
-- 
2.17.1

